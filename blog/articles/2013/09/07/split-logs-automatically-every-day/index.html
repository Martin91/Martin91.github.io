
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Split logs automatically every day - Martin</title>
	<meta name="author" content="Martin">

	
	<meta name="description" content="Related resource(s): &ldquo;linuxcommand: logrotate&rdquo;:http://linuxcommand.org/man_pages/logrotate8.html
logrotate is designed to ease &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Martin" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="/javascripts/jquery-1.11.1.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Martin</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:Martin91.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:Martin91.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Split Logs Automatically Every Day</h2>
	<div class="entry-content"><p><strong>Related resource(s):</strong></p>

<p>&ldquo;linuxcommand: logrotate&rdquo;:<a href="http://linuxcommand.org/man_pages/logrotate8.html">http://linuxcommand.org/man_pages/logrotate8.html</a><br>
<strong>logrotate</strong>  is  designed to ease administration of systems that generate large numbers of log files. Normally, logrotate is run as a daily cron job.</p>

<p><strong>Some important knowledges:</strong></p>

<ul>
<li>Any number of config files may be given. Later config files may override the options given in earlier files, so the order in  which  the logrotate config files are listed in is important.  Normally, <strong>a single config file which includes any other config files which are  needed  should  be used</strong>.  If a directory is  given, every file in that directory is used as a config file.</li>
<li><strong>Default config file:</strong> /etc/logrotate.conf. You can include other config files within it using <strong>include</strong> directive.</li>
</ul>


<!-- More -->


<h2>Assumption</h2>

<ol>
<li>Your site is <code>example.com</code></li>
<li>The site is located in <code>/var/www/example/</code></li>
<li>Your site is deployed by Capistrano, so you can find your logs in <code>/var/www/example/shared/log/</code></li>
<li>Your static contents server is <strong>Nginx</strong>, and its logs are located in <code>/var/www/example/shared/log/</code> and their names start with <code>nginx_</code></li>
</ol>


<h2>How to do</h2>

<h3>1. Login your server</h3>

<h3>2. Make sure that &ldquo;include /etc/logrotate.d&rdquo; is existed in default config file and not commented:</h3>

<pre>
$ cat /etc/logrotate.conf
</pre>


<p>You should be able to find the directive shown below, if not, append it manully.</p>

<pre>
include /etc/logrotate.d
</pre>


<h3>3.Create new logrotate config files for your site&rsquo;s logs</h3>

<p><strong>A. Create new rotate config file for application log:</strong></p>

<pre>
$ sudo vim /etc/logrotate.d/example_production_log
</pre>


<p>Type following contents, and save.</p>

<pre>
/var/www/example/shared/log/production.log {

  daily

  missingok

  rotate 30

  notifempty

  create 664 deploy deploy

  copytruncate

}
</pre>


<p><strong>B. Create new rotate config file for server log:</strong></p>

<pre>
$ sudo vim /etc/logrotate.d/nginx-log-for-example
</pre>


<p>Type following contents, and save.</p>

<pre>
/var/www/example/shared/log/nginx_*.log {

  daily

  missingok

  rotate 30

  notifempty

  create 664 root root

  sharedscripts

  postrotate

  [ ! -f /var/run/nginx.pid ] || kill -USR1 `cat /var/run/nginx.pid`

  endscript
}
</pre>


<p><strong>Attention:</strong><br>
<strong>/var/run/nginx.pid</strong> is your nginx pid file path, but someone may use default nginx pid path(<strong>/opt/nginx/logs/nginx.pid</strong>). You have two solutions to solve this conflict:</p>

<blockquote><ol type="a">
<li>Change <code>/var/run/nginx.pid</code> to <code>/opt/nginx/logs/nginx.pid</code> or other path you have defined in your nginx config file.</li>
<li>Set your <strong>&ldquo;pid&rdquo;</strong> directive to expected path:
<pre>
pid /var/run/nginx.pid;
</pre>
in your nginx config file(such as, /opt/nginx/conf/nginx.conf), and then restart your server.</li>
</ol>
</blockquote>

<p>If the above work are all finished, everything done! You should remember to check if everything runs normally at other days.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-09-07T01:11:00+08:00" pubdate data-updated="true">Sep 7<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/support/'>support</a>, <a class='category' href='/blog/categories/tips/'>tips</a>


</div>
	
	<div class="comments"><a href="#disqus_thread">Comments</a></div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Martin

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'martin-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://Martin91.github.io/blog/articles/2013/09/07/split-logs-automatically-every-day/';
        var disqus_url = 'http://Martin91.github.io/blog/articles/2013/09/07/split-logs-automatically-every-day/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F6d4498d8e2d7328fffdb1539f0589a61' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '781315158664022',
      xfbml      : true,
      version    : 'v2.4'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

</body>
</html>